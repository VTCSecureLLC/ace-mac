language: objective-c
osx_image: xcode7
env:
  global:
  - MACOSX_DEPLOYMENT_TARGET=10.7
  - LDFLAGS="-Wl,-headerpad_max_install_names"
  - secure: MLSvcwDVgvgBiJSSdLydXnGGcKeMr+RzHOG4G78Y49FaJL0N4YThjDMLB8K1RLDtQDZlJFNIT36AmQolZ7/ufDsi0SdKyYMZ1LW+/aJpsUQWzqVU3w3FFhgWzLbla3GXIFUM3oY7Oegc+mk4rxcScGWV6jxdTHMxAeTpS8XSdR8Eve2qQKB2O5r8kWtdS5/VsIpNmD/P2FBQ07MGx7WHUgvDHXNe4gN14NgrBLcNp5+863xMm0CnrZSfTAIAk1tOGvc1WW9oGn4vAvFefSeNjuud3gVxapZbHuZDy/9FpPT8+iyUVLoI0KrvRTHH9mBYqEnKHJU+JxQkQ29nfeOYMECMJWMlCaiwz9K35UiuYZOt4yGq58IM0wgb48c3V1hw4qZqNPDH50tV1NCacwnAx2/lhmdGBgz+UkNpZmQPbrYudYwK4Q3TLuoFHs+N4afU+7o/WxRf5Nnb6R7cjugYLR3h6RRsnCDVEZtXOnGrck/YMs+63tSojFQSQmFf6XsA/9sJi0Dwx2nd6ao0FMO+XmSGaYYPzWC/cXmxp6CYWB40cdktnAFpIHl0Hx5IQ7rYLfB+ANXFi/CdJzZWAxACRTfemcJvOgYyIuYt4v+O6csNVK7SLL9imt3ZCX6mP4wx8qUxP7fRWmKzrlCFrS+84b3FVFUkGGw6hO2nc4OGThM=
  - secure: fHE0sOXe5MNM1Cj4MXJPTBrjQTFk36DAAzyJH3bjjejtNCeXqyxX4WdJvUF/q2jgjDPkrHBBZ+LymhcJ0szI1OdHIZNtwrrWo6ez+1FQ5R9hJPJUmR/pZ2rFrsMXRRhVV+I18j1yDE7qrx9p4O8xLYAgp6agQxEF5svUtW2Y460q9z2Oz+PCOyunCaMdjEycoeXxQYZ2Ob4WPHAZC3vlfkkm1+nwbeBOoYb+WN68tOUN8GnzmtrXWcfatgP+4qHg0UI8/2Y3/DNX3ZfE9Y8khQkt1lUlgJBTOIW3jMA34e9XVYFBXexYQDk4mpzWnDnhtYlHPDx/joeYE6LoWp+K+T3DDU1TBXWzgRgsZYZda2oOG5cJp0k+Y+2Bd+7crTG0UJeQlbcG/7W94F2Sk50UEAHFI4IKEenRPBvhkmIWqDBZTDxE88OZzeuRse6HRJjC9dZFyOBbGXYBmXDyDb5qPeIRhehLvi5GM84JlpIX/nyTDnhbaV4V01ieGJ9BB2rYmCU3MlwXlAddBml/V83mBqhPJViXeWM5I6p+nMggJz1ttK+ddHrHcMDDNtcI0WbzoLdWBOITF5XtfzzRceBhb85qSMRGe7d/PgNIm8lwF4lQaB+26MvXfPLUGZ9HkaI3AML1KV+RYYbZWl0Cg0VQ8B1b2QHX9502MF685GqoIDY=
  - secure: vuWwGyqwQFBqAIFbg5vwv7UPe0J9YV2gIIIJGryJKcMF6ATEwFULjOXTfcJ7yt+9InxZBzgWCuYF1Ewy0mADZfaogK1pBMHqLyB1lhiwF6I240eGiC+UtZwlkTTQdvuu0OBeKjfKYLNIuQae499wH/pU3qljhSDxjOFL38st4aF5DNQmDWsToUL4Gq1Ckk6TLtnUNpLaOUITQpB7VjUbHZYV7yOy9fcYthCYBy77tW3wesPjlSNu1PVPKItKGTsjGhMl1JKZPg5gwePegUT8uNmN1eklGKCVHkz+jgg4zgdZtDdo+aGMF0zWBCG1CU07kqvz3nGwCHIP5K6lG2Sp6Buq3wH7QXXd5prQReo8zHkxVdbeJeqj3ikokVeFOijMnsQRvXTrB38KghRje81UvghYUylahARiz1vlHlvoB8sjZr/k0IBsXQgQoZEgWX9nmwU0ZfjJF79mNS+0ejfA+V+8iMF8aQf7B+j23MjGpkxoNUCMvwqDm1fT1uptv/tNOz/2X/a5mfKk7hof+rLBaLLDzWeAUkRLm4sfKwuo1QBAwGzmCBu8biR+CrqZRMGbSTqM57buaZ2PWCYw7iCwwOUG6wBh3Iv45exvYmFDxYtMx5uhkFt5Rvye9DYslyxZDBP9YVTElxiyvTOfYCht+teCHyRf6bvEKFRkd105/74=
  - secure: vcbdH12RDqcnnrKm1STVlYfXMDECqBxSAbHHI69ridtPFfCVeGDE6McN8gBwnc30K9ww4VesGbGg1mcmzMPvf0mi4bLkz8GKaFrzSTpL4zLzxJxMBa/y6Lc9S1SJNsA6r/8Mea2ymT2Jd2YtSF7eHInJ1XMfK9ZrqwNODlliFEnGubk1JEuOIUGw6niayEjv5IpWZvZn6zrxMMCsjhaFj/Ht4rZxjvAWA9owgrG/6Ra90IJghl9fm5nFlSzrgrDnOBX3P1c3HNXXYmPBzZea5zDnnIQMDqRvWtUzgkLnkYfJ11FABQ2SI2Tu2tMW3EcnUZhwa+BP1szhpsjlzWiT3gXnTjAIIpT3JXsDit6RQCsNbZywwbKTMaEeYdvSsJXOOdGDULymgB7nTUzzPhmPYJ41hGctIFERHA1Hhkl6zriW5Zz2CVe5zRaLHsH+1XQw9WgPL+sl5JXtt8XC2aKegr7dAxlQyP2TjJAEaR6mjI5W6yF670UgpRY7Ha0d5ltKiaKf/YtXNPs84fXs1dEnUmQQAoaWBZ5VstLgNUk4u4jERvFz8xcJemkzYxYGa9QjyFGk3CNOLZr4InHQBulXGEEckvjuQgIAzY0duDhTyTmuwz+ZHC/KTskRqe8+N+3zJ6ymkX2XBrlYcPHZOPdCqWDWW8apEQ+EA/lnvA41/7g=
  - secure: geOtrhBEzrHDhw8pYh2jBHBRsWcQWVKx56ZJMKlcAZA+M6brulsHPfhsKlEvejDfTYomTngO1JFbgJp6hIJFeZ1wQfJnyIXGx771qBtCR28IAruiuxGjL7tGKDtMFViOd5PYYQdKTLyHKBbZMLZwr80EI92Yx8IACqRdxUo7sWTtHegRl0UaDF5/kalKasQtEHw0i/zCRN8wcSF73g/oK8rhCaYzEj6tjJipgT98CiWnRFXhwVVGdo5gEfWTkUOFPDZS2FT0dBJBCb9/urMgzsno0rULpisSjevQEhjbjM/vY3coDNO/kv+IZlRJVKGk88lou0BWv9COtzQtj+Uf3V0/O8AdkCBHIXK5h0RfPaYHEYG3DU1+xkGV4WQekzuxK7NI/2hoDmAri2o/FMHD+o23pUJccsZIs26NS6w2yRxSZBKLeNhK4o1ZJGP1JwEjnOtvm9TwLnOU5QG6MRuLowK5LeOnJNoX6t4G5ex6AEQH/B5xQLYWeWeWJ175IlMnVORAgTnfv0lwgO1BbAs2NXKQfHrF7AAOAjCOFlyhvoRUKH0mDwj/WpSfBQ1wLIPljMMkJK+Df7cW0V6/CTMUfra5rDyzgzBf2P7b9jJS4nJebqEubhBhQ1aB4SM/OLLVnGTsTrEYgg0tgumc/0iZBEfMzXAZQLFB0uq8OLdleV8=
  - secure: QK93z2l5cXjKS8Qjt0tb3kDYQLL9bN9mEZMLmcAGz/DvNVIKVeMA/k2Xwu07xmZo6qc32iQmFUvxMwDM2cmC7+vh7XMaPIT9XBBapSU7glZU3amrAdvti6wNxvPMldQ0h/cCmqtDthIO2K3snxa44VoL3HtTj0YD7p5ILBS2/2gPAAJt5sRQTNtMNRawe0Ot6SHiITlGpO9Lz6IDFSZK+Xv/X0Mom4fu4osYWzK7/aaOYLWHK3IRqphKkn4TYm/EWlyGx6T8/6xI8ZDCxPv56FWLdAQduUWw1e8TDC1IZkrSU4q83sDTAUEgvjd8kJTfYr5M73/wsyHB62QFRTyAICjXDmxAZSHZ24OpRIt5tVWoUOGpRK8mUGql0GZ/jOd4CI3LnPBLwIiLdpLSdHJdstjrKJfpbaZ25cn8DuQfrSFp+D6tmGVoSZcH5WBB2FZ/+J+X3qDlPCV6Gxef4V+eQEP8XI5pRF3IWQl+ToykqvolqA4IqT+Uv5AJg09ZwsvddjrcWLEQmdafzc+UYwNs9YVHTros1oyBcDEDpvNCXoTfJVPvpMD7XVxq72G9usbhiuvBXC4nuyOjNK5lT53u7zgwniRrdvzc6vRUzg/d3Ocfw3LVWdkg9gx9IC9yLuzJbMy5bXd8YRylvBsGgcVY+fl3kQg7KAFhoLpzndQismM=

before_script:
- export HOMEBREW_PREFIX=$HOME/.homebrew
- if [[ -d $HOMEBREW_PREFIX ]]; then echo "HOMEBREW_PREFIX=$HOMEBREW_PREFIX"; else rsync -aq /usr/local/ $HOMEBREW_PREFIX; fi
- export PATH=$HOMEBREW_PREFIX/bin:$PATH; hash -r
- which ccache || brew install ccache || brew link --force ccache || true
- which md5deep || brew install ccache || brew link --force md5deep || true
- export CCACHE_DIR=$HOME/.ccache
- export LINPHONE_CCACHE=ccache
- export CCACHE_SLOPPINESS=pch_defines,time_macros,include_file_mtime,include_file_ctime,file_macro
- export CCACHE_COMPILERCHECK=content
- ccache -M 5G
- ccache -s 
- brew update 1>/dev/null
- brew install doxygen nasm yasm optipng imagemagick coreutils intltool ninja antlr cmake gettext
- brew link --force gettext
- brew install cairo --without-x11
- brew install gtk+ --without-x11
- brew install gtk-mac-integration hicolor-icon-theme
- wget --no-check-certificate https://raw.github.com/yuvi/gas-preprocessor/master/gas-preprocessor.pl
- chmod +x gas-preprocessor.pl
- sudo mv gas-preprocessor.pl /usr/local/bin
- sudo ln -s /usr/local/bin/glibtoolize /usr/local/bin/libtoolize
- git submodule update --init --recursive
- bundle install
- ./Tools/git_version.sh
script:
- python prepare.py -G Ninja -DENABLE_WEBRTC_AEC=ON -DENABLE_H263=YES -DENABLE_FFMPEG=YES -DENABLE_NON_FREE_CODECS=ON  -DENABLE_GPL_THIRD_PARTIES=ON -DENABLE_AMRWB=YES -DENABLE_AMRNB=YES -DENABLE_OPENH264=YES -DENABLE_G729=YES -DENABLE_MPEG4=YES -DENABLE_H263P=ON -DENABLE_ILBC=ON -DENABLE_ISAC=ON -DENABLE_SILK=ON -p
- ./Tools/build_script.sh
- xcodebuild -project ACE.xcodeproj -alltargets -parallelizeTargets -configuration
  Debug build CODE_SIGNING_REQUIRED=NO CODE_SIGN_IDENTITY="" CODE_SIGN_ENTITLEMENTS="" 
- xcodebuild -project ACE.xcodeproj -alltargets -parallelizeTargets -configuration
  Release build CODE_SIGNING_REQUIRED=NO CODE_SIGN_IDENTITY="" CODE_SIGN_ENTITLEMENTS="" 
after_success:
- ./Tools/release.sh
notifications:
  flowdock:
    secure: Q/taeNYk84ItWA6Lbenl8GbuB6IuV5Og4uznX4W0Hp5Yxir+r0OBVknARZdk4vHDecLEK53byRLrCGzL55vjfqjDc6TK/08Cb0i6Ajv94xcvy4y1PrrSsiECz7ZZzoDP1nHX/KLXrdCLOHfhVe9vP3W7PTa0XL5j98Sl47BemiANR8AzcxByUthRFrTXq+Hrbn2zHbrezAcVNxz8/tBuCWPIS2PgtVmR1GK4PHiSZWKQRwsST+YTG2sX/UhMA05SObblU5Jy6tzf9KXeW5COsuWRwk9qhhnYliPY26epFIxJwHBQpFUgiH87ZIQVhXkJ9+LMERLZSFqAQTrOlmId9TE956UeypHiNVKqa5KN2Ig6Inm5KaPkjehxPA1ELSwBaHlka+C5zlvpKUvO14OWgJEVVSmFRtA9jr9w1R2V2HqI6yjHDl03Xmn1sLYzjlJxUcqCuC8wAk0K6x54c/y6XEP1oRzXAB/CTv6aAZOtyXU8wtpkWjVIrAKl3hcS/46DwKnOioFhRubFAYLLlRqFhIFg6Ite07COr2+kaGUXdMQGCFYh0n8u+PG5R/L570qTajVQKLFE/DqfMqjj+F+yUPLJCbSvG7//FK5fpBa2ALGJjBUnkC4vIx5ytqldzIBnECDdyrqgkIqodwnubWelaQIbMG6CJiBQqQHqj05I9J4=
